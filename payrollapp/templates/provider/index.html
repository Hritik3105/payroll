{% extends 'layout/admin.html' %}

{% block title %} Due {% endblock %}


{% block content %}


<div class="content-wrapper">

  <!-- Content -->
  
    <div class="container-xxl flex-grow-1 container-p-y">
      
      
<h4 class="py-3 breadcrumb-wrapper mb-4">
<span class="text-muted fw-light"></span> Provider Parameter 
</h4>
<div class="row-fluid">

</div>
<!-- Ajax Sourced Server-side -->
<div class="card">
<h5 class="card-header"> Provider Parameter </h5>
<div class="card-datatable text-nowrap">
<table class="datatables-ajax table table-bordered" id="datatables">
<thead>
  <tr>
    <td hidden >id</td>
    <th>Company Name</th>
    <th>VAT ID</th>
    <th>Bank Account</th>
    <th>Bank Beneficiary</th>
    <th>Bank Code</th>
    <th>Payment Term</th>
    <th>Email Notification</th>
    <th>Action</th>
  </tr>
</thead>
<tbody>    
  {%for j in pro %}         
  <tr>
    <td hidden>{{j.id}}</td>
      <td>{{j.business_name}}</td>
      <td>{{j.provider_name}}</td> 
      {%if j.account%}
      <td><input type='text' class="val" value={{j.account}}></td>
      {%else%}
      <td><input type='text' class="val"></td>
      {%endif%}
      <td><select name="cars" id="cars" class="cars">
        <option value="{{forloop.counter}}" data-sync="{{forloop.counter}}">Select Bank</option>
        {% for i in bank %}
        {%if i.bank_name == j.bank_name%}
        <option value="{{forloop.counter}}" data-sync="{{forloop.counter}}" selected>{{j.bank_name}}</option>
        {%else%}
        <option value="{{forloop.counter}}" data-sync="{{forloop.counter}}">{{i.bank_name}}</option>
        {%endif%}
        {%endfor%}
      </select></td>
        
      {%if j.bank_code%}
      <td id="val">{{j.bank_code}}
      {%else%}
      <td id="val">
      {%endif%}
        
    </td> 
     
    <td><select name="payment" id="payment" class="payment">
      {%if j.payment_term == "90" %}
      <option value="Select">Payment term</option>
      <option value="{{j.payment_term}}" selected>{{j.payment_term}} days</option>
      <option value="0">Counted</option>
      <option value="7">7 days</option>
      <option value="15">15 days</option>
      <option value="30">30 days</option>
      <option value="45">45 days</option>
      <option value="60">60 days</option>
      <option value="75">75 days</option>
      <option value="90">90 days</option>
      <option value="Custom">Other</option>

      {%elif j.payment_term == "7" %}
      <option value="Select">Payment term</option>
      <option value="{{j.payment_term}}" selected>{{j.payment_term}} days</option>
      <option value="0">Counted</option>
      <option value="15">15 days</option>
      <option value="30">30 days</option>
      <option value="45">45 days</option>
      <option value="60">60 days</option>
      <option value="75">75 days</option>
      <option value="90">90 days</option>
      <option value="Custom">Other</option>

      {%elif j.payment_term == "15" %}
      <option value="Select">Payment term</option>
      <option value="{{j.payment_term}}" selected>{{j.payment_term}} days</option>
      <option value="0">Counted</option>
      <option value="7">7 days</option>
      <option value="30">30 days</option>
      <option value="45">45 days</option>
      <option value="60">60 days</option>
      <option value="75">75 days</option>
      <option value="90">90 days</option>
      <option value="Custom">Other</option>

      {%elif j.payment_term == "30" %}
      <option value="Select">Payment term</option>
      <option value="{{j.payment_term}}" selected>{{j.payment_term}} days</option>
      <option value="0">Counted</option>
      <option value="7">7 days</option>
      <option value="15">15 days</option>
      <option value="45">45 days</option>
      <option value="60">60 days</option>
      <option value="75">75 days</option>
      <option value="90">90 days</option>
      <option value="Custom">Other</option>

      {%elif j.payment_term == "45" %}
      <option value="Select">Payment term</option>
      <option value="{{j.payment_term}}" selected>{{j.payment_term}} days</option>
      <option value="0">Counted</option>
      <option value="7">7 days</option>
      <option value="15">15 days</option>
      <option value="30">30 days</option>
      <option value="60">60 days</option>
      <option value="75">75 days</option>
      <option value="90">90 days</option>
      <option value="Custom">Other</option>

      {%elif j.payment_term == "60" %}
      <option value="Select">Payment term</option>
      <option value="{{j.payment_term}}" selected>{{j.payment_term}} days</option>
      <option value="0">Counted</option>
      <option value="7">7 days</option>
      <option value="15">15 days</option>
      <option value="30">30 days</option>
      <option value="45">45 days</option>
      <option value="75">75 days</option>
      <option value="90">90 days</option>
      <option value="Custom">Other</option>

      {%elif j.payment_term == "75" %}
      <option value="Select">Payment term</option>
      <option value="{{j.payment_term}}" selected>{{j.payment_term}} days</option>
      <option value="0">Counted</option>
      <option value="7">7 days</option>
      <option value="15">15 days</option>
      <option value="30">30 days</option>
      <option value="45">45 days</option>
      <option value="60">60 days</option>
      <option value="90">90 days</option>
      <option value="Custom">Other</option>

      {%elif j.payment_term == None %}
      <option value="Select">Payment term</option>
      <option value="0">Counted</option>
      <option value="7">7 days</option>
      <option value="15">15 days</option>
      <option value="30">30 days</option>
      <option value="45">45 days</option>
      <option value="60">60 days</option>
      <option value="75">75 days</option>
      <option value="90">90 days</option>
      <option value="Custom">Other</option>

      {%else%}
      <option value="Select">Payment term</option>
      <option value="0">Counted</option>
      <option value="7">7 days</option>
      <option value="15">15 days</option>
      <option value="30">30 days</option>
      <option value="45">45 days</option>
      <option value="60">60 days</option>
      <option value="75">75 days</option>
      <option value="90">90 days</option>
      <option value="Custom" selected>Other</option>
      <div id="other_box">
       
        <input id="test" value="{{j.payment_term}}"days>
      </div>
      {% comment %} <option value="{{j.payment_term}}" selected>{{j.payment_term}} days</option> {% endcomment %}

      
      {%endif%}
    </select>
  
    <div id="other_box"></div>  
    </td>
    {%if j.email%}
    <td><input type='text' class="vals" value={{j.email}}></td>
    {%else%}
    <td><input type='text' class="val"></td>
    {%endif%}
      <td> <input type='button' class='myclass'  value='save'  onclick='myTest(this)'/>
    </td>
    
  </tr>

  {%endfor%}

</tbody>
</table>
</div>
</div>


<!--/ Ajax Sourced Server-side -->


  

{% endblock content %}


{% block javascripts %}
  {{ block.super }}

  <script>
    $(document).ready(function() {
        $('#datatables').DataTable( {
          scrollX: true,
        
          
           
        });
    });
    </script>
  
  <script>

$(".cars").change(function(){
  
  const element = document.getElementById("cars");
  const checkText = element.options[element.selectedIndex].text;
  var currentRow=$(this).closest("tr");
  console.log("hello1",currentRow)

  var bank_name = currentRow.find("#cars option:selected").html();
  var value = $('select#cars option:selected').val();
  console.log("hello2",value)
  
  var rr = currentRow.find("#cars option:selected").val();
  console.log("hello3",(rr))
  
  $.ajax({
        type:"GET",
        url: '/insurance/update-insurance-status/',
        data: {
          'id': rr
        },
        dataType: 'json',
        success: function (data) {
          var rr = currentRow.find("#val").html(data.id);
        }
     
      });

    });

  

    function myTest(a)
  {
    var currentRow=$(a).closest("tr");
  
    var bank_id = currentRow.find("td:eq(0)").html();
    var bank_account = currentRow.find("td:eq(3)").html(); 
    var email = currentRow.find("td:eq(7)").find('input').val(); 
    
    var asd01 =currentRow.find('td:eq(3)').find('input').val();// value of input box
    var days = currentRow.find("td:eq(6) input[id='test']").val()
    
    var bank_name = currentRow.find("#cars option:selected").html();
    
    var payment_term = currentRow.find("#payment option:selected").val();
    var bank_code = currentRow.find("td:eq(5)").html();
    
    if(bank_name == "Select Bank"){
      alert("Please Select Bank");
    }
    else{
  
      alert("Data Updated Successfully");
  
    
    $.ajax({
          type:"GET",
          url: '/bank/details/',
          data: {
            'id': bank_id,
            'bank_name':bank_name,
            'bank_code':bank_code,
            'bank_no':asd01,
            'payment':payment_term,
            'dayss':days,
            'email':email
          },
          dataType: 'json',
          success: function (data) {

            $('#cars option:selected').val(data.result);
            
          }
       
        });
  
    }
  
  }
</script>


<script>

  
    $(".payment").change(function () {
   
      var currentRow=$(this).closest("tr");
      var payment = currentRow.find("td:eq(0)").html();
      var payment_term = currentRow.find("#payment option:selected").val();
      
      if (payment_term == "Custom") {
        currentRow.find("td:eq(6) #other_box").append('<input id="test">');
        var days = currentRow.find("td:eq(6) input[id='test']").val()
        console.log(days)
        //var col1=currentRow.find("td:eq(1) input[type='time']").val();
      }
      else{
        currentRow.find("td:eq(6) input[id='test']").remove();
        //var days = get value of selected value
      }
      
      $.ajax({
            type:"GET",
            url: '/payment/details/',
            data: {
              'id':payment_term ,
            },
            dataType: 'json',
            success: function (data) {
              
              
              
            }
        
          }); 
      });
   
    
</script>
{% endblock javascripts %}